<h2>Agendas pendentes por Cliente</h2>

<div *ngIf="loading">Loading...</div>
<div *ngIf="error" style="color: red">{{ error }}</div>

<mat-accordion multi>
  <mat-expansion-panel *ngFor="let group of groupedSchedules">
    <mat-expansion-panel-header>
      <mat-panel-title>
        {{ group.client_name }}
      </mat-panel-title>
      <mat-panel-description>
        {{ group.schedules.length }} pending item(s)
      </mat-panel-description>
    </mat-expansion-panel-header>

    <table mat-table [dataSource]="group.schedules" class="mat-elevation-z2">

      <!-- Date -->
      <ng-container matColumnDef="start_time">
        <th mat-header-cell *matHeaderCellDef> Date </th>
        <td mat-cell *matCellDef="let s"> {{ s.start_time | date:'dd/MM/yyyy' }} </td>
      </ng-container>

      <!-- User -->
      <ng-container matColumnDef="user_name">
        <th mat-header-cell *matHeaderCellDef> User </th>
        <td mat-cell *matCellDef="let s"> {{ s.user_name }} </td>
      </ng-container>

      <!-- Status -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef> Status </th>
        <td mat-cell *matCellDef="let s"> {{ s.status }} </td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Actions </th>
        <td mat-cell *matCellDef="let s">
          <button mat-icon-button color="primary" *ngIf="s.status === 'pending'" (click)="approve(s.schedule_id, s.user_id)">
            <mat-icon>check_circle</mat-icon>
          </button>
          <button mat-icon-button color="warn" *ngIf="s.status === 'pending'" (click)="reject(s.schedule_id, s.user_id)">
            <mat-icon>cancel</mat-icon>
          </button>
          <button mat-icon-button color="accent" *ngIf="s.status === 'missing'" (click)="remind(s.schedule_id, s.user_id)">
            <mat-icon>notifications</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['start_time', 'user_name', 'status', 'actions']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['start_time', 'user_name', 'status', 'actions']"></tr>
    </table>
  </mat-expansion-panel>
</mat-accordion>
