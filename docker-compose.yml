services:
  angular:
    build:
      context: ./frontend/gestor-links
      dockerfile: Dockerfile   # opcional, se o nome for diferente
    image: linxfsa/linksproject:angular
    platform: linux/amd64
    ports:
      - "4200:80"
    depends_on:
      - server-js
    networks:
      - app-network

  server-js:
    build:
      context: ./frontend/gestor-links/backend-nodes
      dockerfile: Dockerfile
    image: linxfsa/linksproject:server-js
    platform: linux/amd64
    container_name: node-server
    ports:
      - "3000:3000"
    environment:
      - RABBITMQ_HOST=rabbitmq-compose
      - RABBITMQ_PORT=5672
    depends_on:
      - rabbitmq-compose
    networks:
      - app-network

  python-consumer:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: linxfsa/linksproject:python-consumer
    platform: linux/amd64
    volumes:
      - ./uploads:/var/uploads
    environment:
      - UPLOAD_DIR=/var/uploads
      - RABBITMQ_HOST=rabbitmq-compose
      - RABBITMQ_PORT=5672
      - MYSQL_HOST=mysql-compose
      - MYSQL_USER=root
      - MYSQL_PASSWORD=123456
      - MYSQL_DB=left
    depends_on:
      - rabbitmq-compose
      - mysql-compose
    networks:
      - app-network

  rabbitmq-compose:
    image: rabbitmq:3-management
    container_name: rabbitmq-compose
    ports:
      - "5672:5672"
      - "15672:15672" # painel web
    networks:
      - app-network

  mysql-compose:
    image: mysql:8.0
    container_name: mysql-compose
    environment:
      MYSQL_ROOT_PASSWORD: 123456
      MYSQL_DATABASE: left
    ports:
      - "3306:3306"
    volumes:
      - ./backend/initdb:/docker-entrypoint-initdb.d
      - mysql_data:/var/lib/mysql   
    networks:
      - app-network

  phpmyadmin:
    image: phpmyadmin/phpmyadmin:latest
    container_name: phpmyadmin-compose
    environment:
      PMA_HOST: mysql-compose   # nome do servi√ßo MySQL no Compose
      PMA_PORT: 3306
      PMA_USER: root
      PMA_PASSWORD: 123456
    ports:
      - "8080:80"               # acessa via http://localhost:8080
    depends_on:
      - mysql-compose
    networks:
      - app-network

networks:
  app-network:
    driver: bridge

volumes:
  mysql_data:

