<mat-tab-group (selectedTabChange)="onTabChange($event)">

  <!-- ABA 1 — Dados Cadastrais -->
  <mat-tab label="Dados Cadastrais">
    <div class="dados-grid">

      <div class="form-field">
        <label>Nome do Cliente:</label>
        <input [(ngModel)]="client.name" />
      </div>

      <div class="form-field">
        <label>Código:</label>
        <input [(ngModel)]="client.code" />
      </div>

      <div class="form-field">
        <label>Moeda Padrão:</label>
        <input [(ngModel)]="client.default_currency" maxlength="3" />
      </div>

      <div class="form-field">
        <label>Prazo de Pagamento (dias):</label>
        <input type="number" [(ngModel)]="client.payment_terms_days" />
      </div>

    </div>
  </mat-tab>

  <!-- ABA 2 — Contatos -->
  <mat-tab label="Contatos">
    <div class="tab-content">

      <h4>Adicionar Contato</h4>

      <div class="add-module-grid">

        <mat-form-field appearance="outline">
          <mat-label>Nome</mat-label>
          <input matInput [(ngModel)]="newContact.name">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input matInput [(ngModel)]="newContact.email">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Telefone</mat-label>
          <input matInput [(ngModel)]="newContact.phone">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Função</mat-label>
          <mat-select [(ngModel)]="newContact.role">
            <mat-option value="CP">Coordenador de Projeto</mat-option>
            <mat-option value="Gerente">Gerente</mat-option>
            <mat-option value="Financeiro">Financeiro</mat-option>
            <mat-option value="Ponto Focal">Ponto Focal</mat-option>
            <mat-option value="Outro">Outro</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Botão com ícone person_add -->
        <button class="custom-save-button add-contact-btn" (click)="addContact()">
          <mat-icon>person_add</mat-icon>
          Adicionar
        </button>

      </div>

      <table>
        <tr>
          <th>Nome</th>
          <th>Email</th>
          <th>Telefone</th>
          <th>Função</th>
          <th>Ação</th>
        </tr>

        <tr *ngFor="let c of clientContacts; let i = index">
          <td>{{ c.name }}</td>
          <td>{{ c.email }}</td>
          <td>{{ c.phone }}</td>
          <td>{{ c.role }}</td>
          <td>
            <button class="remove-button" (click)="removeContact(i)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </tr>
      </table>

    </div>
  </mat-tab>

  <!-- ABA 3 — Contratos -->
<mat-tab label="Contratos">
  <div class="tab-content">

    <h3>Novo Contrato</h3>

    <div class="dados-grid">

      <mat-form-field appearance="outline">
        <mat-label>Tipo de Contrato *</mat-label>
        <mat-select [(ngModel)]="newContract.contract_type">
          <mat-option value="">Selecione...</mat-option>
          <mat-option value="full_time">Full Time</mat-option>
          <mat-option value="part_time">Part Time</mat-option>
          <mat-option value="hourly">Por Hora</mat-option>
          <mat-option value="project">Por Projeto</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Valor Base *</mat-label>
        <input matInput type="number" [(ngModel)]="newContract.base_value">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Multiplicador</mat-label>
        <input matInput type="number" [(ngModel)]="newContract.multiplier">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Vigência Inicial *</mat-label>
        <input matInput type="date" [(ngModel)]="newContract.valid_from">
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Vigência Final</mat-label>
        <input matInput type="date" [(ngModel)]="newContract.valid_to">
      </mat-form-field>

    </div>

    <div class="save-container">
      <button class="custom-save-button" (click)="addContract()">
        <mat-icon class="save-icon">add</mat-icon>
        Adicionar Contrato
      </button>
    </div>

    <h3 style="margin-top: 30px;">Contratos Cadastrados</h3>

    <table *ngIf="clientContracts.length > 0">
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Valor Base</th>
          <th>Multiplicador</th>
          <th>Início</th>
          <th>Fim</th>
          <th>Ações</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let c of clientContracts">
          <td>{{ c.contract_type }}</td>
          <td>{{ c.base_value }}</td>
          <td>{{ c.multiplier }}</td>
          <td>{{ c.valid_from }}</td>
          <td>{{ c.valid_to }}</td>
          <td>
            <button (click)="removeContract(c.id)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <p *ngIf="clientContracts.length === 0">Nenhum contrato cadastrado.</p>

  </div>
</mat-tab>


  <!-- ABA 4 — Invoices -->
  <mat-tab label="Invoices">
    <div class="tab-content">

      <table>
        <tr><th>Número</th><th>Valor</th><th>Status</th><th>Arquivo</th></tr>
        <tr *ngFor="let inv of clientInvoices">
          <td>{{ inv.invoice_number }}</td>
          <td>{{ inv.amount }}</td>
          <td>{{ inv.status }}</td>
          <td><a *ngIf="inv.file_path" [href]="inv.file_path" target="_blank">Ver NF</a></td>
        </tr>
      </table>

      <h4>Nova Invoice</h4>
      <input #invoiceNumber placeholder="Número" />
      <input #invoiceAmount type="number" placeholder="Valor" />
      <input type="file" (change)="onFileSelected($event)" />
      <button (click)="addInvoice(invoiceNumber.value, invoiceAmount.valueAsNumber)">
        Adicionar
      </button>

    </div>
  </mat-tab>

</mat-tab-group>

<!-- Botão Salvar -->
<div class="save-container">
  <button class="custom-save-button" (click)="saveClient()">
    <mat-icon class="save-icon">save</mat-icon>
    Salvar
  </button>
</div>
