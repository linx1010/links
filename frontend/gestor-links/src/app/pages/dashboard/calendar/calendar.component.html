<div class="agenda-header">
   <h2>
    <span (click)="voltar()" 
          matTooltip="Voltar" 
          style="cursor:pointer;">
      Agenda de {{ nomeAgenda }}
    </span>
  </h2>
</div>
<!-- üìÖ Cabe√ßalho do calend√°rio -->
<div class="calendar-header">
  <button (click)="prevMonth()">‚óÄ</button>
  <h2>{{ currentDate | date: 'MMMM - yyyy' }}</h2>
  <button (click)="nextMonth()">‚ñ∂</button>
</div>

<!-- üóìÔ∏è Grade do calend√°rio -->
<div class="calendar-grid">
  <div class="day" *ngFor="let d of days" (click)="onDayClick(d)">
    <div *ngIf="d.day">
      <strong>{{ d.day }}</strong>

      <!-- üìå Eventos do dia -->
      <div class="event" *ngFor="let e of d.events"[ngClass]="{ 'concluido': e.status === 'completed' }">
        <span>{{ e.title }}</span><br>
        <span *ngIf="e.location">üìç {{ e.location }}</span>

      </div>
    </div>
  </div>
</div>

<!-- üìã Detalhes do dia selecionado -->
<div class="day-details" *ngIf="selectedDay">
  <h3>Eventos do dia {{ selectedDay.day }}:</h3>

  <div *ngIf="selectedDay.events.length > 0; else noEvents">
  <table mat-table [dataSource]="selectedDay.events" class="event-table" *ngIf="selectedDay.events.length > 0">

  <!-- T√≠tulo -->
  <ng-container matColumnDef="title">
    <th mat-header-cell *matHeaderCellDef>T√≠tulo</th>
    <td mat-cell *matCellDef="let e">{{ e.title }}</td>
  </ng-container>

  <!-- Hora In√≠cio -->
  <ng-container matColumnDef="start_time">
    <th mat-header-cell *matHeaderCellDef>In√≠cio</th>
    <td mat-cell *matCellDef="let e">{{ e.start_time | date: 'shortTime' }}</td>
  </ng-container>

  <!-- Hora Fim -->
  <ng-container matColumnDef="end_time">
    <th mat-header-cell *matHeaderCellDef>Fim</th>
    <td mat-cell *matCellDef="let e">
      {{ e.end_time ? (e.end_time | date: 'shortTime') : '‚Äî' }}
    </td>
  </ng-container>

  <!-- Localiza√ß√£o -->
  <ng-container matColumnDef="location">
    <th mat-header-cell *matHeaderCellDef>Local</th>
    <td mat-cell *matCellDef="let e">{{ e.location || '‚Äî' }}</td>
  </ng-container>

  <!-- A√ß√µes -->
  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef>A√ß√µes</th>
    <td mat-cell *matCellDef="let e">
      <button mat-icon-button color="primary" (click)="visualizarEvento(e)" matTooltip="Visualizar evento">
        <mat-icon>visibility</mat-icon>
      </button>

      <button mat-icon-button color="accent" (click)="concluirEvento(e)" matTooltip="Concluir">
        <mat-icon>check_circle</mat-icon>
      </button>

      <button mat-icon-button color="warn"
              *ngIf="tipo === 'client'"
              [disabled]="e.end_time"
              (click)="excluirEvento(e)"
              matTooltip="Excluir (desabilitado se conclu√≠do)">
        <mat-icon>delete</mat-icon>
      </button>
    </td>
  </ng-container>

  <!-- Cabe√ßalho e linhas -->
  <tr mat-header-row *matHeaderRowDef="['title', 'start_time', 'end_time', 'location', 'actions']"></tr>
  <tr mat-row *matRowDef="let row; columns: ['title', 'start_time', 'end_time', 'location', 'actions']"></tr>
</table>
</div>

  <!-- üîï Caso n√£o haja eventos -->
  <ng-template #noEvents>
    <p>N√£o h√° eventos para este dia.</p>
  </ng-template>

 <!-- ‚ûï Formul√°rio para adicionar evento -->
<div class="add-event" *ngIf="tipo === 'client'">
  <h4>Adicionar novo evento</h4>

  <form (ngSubmit)="submitEvento()" #eventoForm="ngForm">
    <!-- T√≠tulo -->
    <mat-form-field appearance="fill">
      <mat-label>T√≠tulo</mat-label>
      <input matInput [(ngModel)]="formEvento.title" name="title" required />
    </mat-form-field>

    <!-- Descri√ß√£o -->
    <mat-form-field appearance="fill">
      <mat-label>Descri√ß√£o</mat-label>
      <textarea matInput [(ngModel)]="formEvento.description" name="description"></textarea>
    </mat-form-field>

    <!-- Participantes -->
    <mat-form-field appearance="fill">
      <mat-label>Participantes</mat-label>
      <mat-select [(ngModel)]="formEvento.user_id" name="user_id" multiple>
        <mat-option *ngFor="let u of recursos" [value]="u.id">{{ u.name }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Bot√£o -->
    <button mat-raised-button color="primary" type="submit" [disabled]="!eventoForm.form.valid">
      Adicionar Evento
    </button>
  </form>
</div>
